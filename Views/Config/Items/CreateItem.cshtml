@using InfoScreenPi.Entities
@model List<Background>

<form>
    <div class="form-group">
        <label for="title">Title</label>
        <input type="text" class="form-control" id="ItemTitle" placeholder="Titel">
    </div>
    <div class="form-group">
        <label for="title">Vervaldatum en -uur</label>
        <div class='input-group date' id='expiredatetimepicker'>
            <input type='text' name="expireDateTime" class="form-control" id="expireDateTime"/>
            <span class="input-group-addon" for="expireDateTime">
                <span class="glyphicon glyphicon-calendar"></span>
            </span>
        </div>
    
    </div>
    
    
    <div class="form-group">
        <label for="content">Inhoud</label>
        <textarea name="editorNewItem" id="editorNewItem" rows="20" cols="80"></textarea>
    </div>
    <div class="form-group">
        <label for="background">Achtergrond</label>
        @await Html.PartialAsync("~/Views/Config/Backgrounds/SelectionGrid.cshtml", Model)
    </div>
</form>
<hr>
<button class="btn btn-primary" id="registerNewItem">Registreer</button>

<script>
    $(function () {
        $('#expiredatetimepicker').datetimepicker();
    });
    $('#expiredatetimepicker input').click(function(event){
        $('#expiredatetimepicker ').data("DateTimePicker").show();
    });
</script>
<script>
        CKEDITOR.replace( 'editorNewItem' , {
            language: 'nl'
        });

        $("#registerNewItem").click(function(){
            var title = $("#ItemTitle").val();
            var content = CKEDITOR.instances.editorNewItem.getData();
            var img = $(".selectedBg").children("img")[0];
            var bgid = $(img).attr('id');
            var expDT = $("#expireDateTime").val();
            

            var postData = { itemTitle: title, itemContent: content, bgId: bgid, expireDateTime: expDT};

            $.ajax({
                type: "POST",
                url: '/Config/Items/RegisterNewItem',
                data: postData,
                success: function(response, textStatus, jqXHR){
                    console.log(response);
                    if(response.success){
                        renewItemsGrid();
                        modal.close();
                        alertify.success(response.message);
                    }
                    else{
                        alertify.error(response.message);
                    }
                },
                dataType: "json",
                traditional: true
            });

        });

</script>